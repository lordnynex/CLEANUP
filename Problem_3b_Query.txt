SELECT PRECALC.TRIPCAT AS TRIPCAT, PRECALC.TOTALMILES/PRECALC.TOTALFUEL AS AVGFUELECO
FROM (SELECT TRIPINFO1.TRIPCAT AS TRIPCAT, SUM((1.0*TRIPINFO2.TRPMILES)) AS TOTALMILES, SUM((1.0*TRIPINFO2.TRPMILES)/TRIPINFO2.EPATMPG) AS TOTALFUEL
        FROM (SELECT 5*(ROUND(DAYTRIP.TRPMILES/5) + 1) AS TRIPCAT
                FROM DAYTRIP
                WHERE DAYTRIP.VEHID>0 AND TRPMILES>=0 AND TRPMILES < 100
                GROUP BY TRIPCAT) TRIPINFO1,
                (SELECT DAYTRIPNEW.TRPMILES AS TRPMILES, VEHICLESNEW.EPATMPG AS EPATMPG, 5*(ROUND(DAYTRIPNEW.TRPMILES/5) + 1) AS TRIPCAT
                FROM
                        (SELECT HOUSEID, VEHID, TRPMILES
                        FROM DAYTRIP
                        WHERE VEHID>0 AND TRPMILES>=0 AND TRPMILES < 100) DAYTRIPNEW,
                        (SELECT HOUSEID, VEHID, EPATMPG
                        FROM VEHICLES) VEHICLESNEW
                WHERE DAYTRIPNEW.HOUSEID = VEHICLESNEW.HOUSEID AND DAYTRIPNEW.VEHID = VEHICLESNEW.VEHID) TRIPINFO2
        WHERE TRIPINFO1.TRIPCAT>=TRIPINFO2.TRIPCAT
        GROUP BY TRIPINFO1.TRIPCAT
        ORDER BY TRIPINFO1.TRIPCAT) PRECALC;

